-- 테이블 순서는 관계를 고려하여 한 번에 실행해도 에러가 발생하지 않게 정렬되었습니다.

-- sp_user Table Create SQL
CREATE TABLE sp_user
(
    `id`     INT            NOT NULL    AUTO_INCREMENT COMMENT '사용자 아이디', 
    `email`  VARCHAR(45)    NOT NULL    COMMENT '사용자 이메일', 
    `name`   VARCHAR(45)    NOT NULL    COMMENT '사용자 이름', 
    PRIMARY KEY (id)
);

ALTER TABLE sp_user COMMENT '사용자';


-- sp_room Table Create SQL
CREATE TABLE sp_room
(
    `id`          VARCHAR(4)     NOT NULL    COMMENT '방 아이디 (네글자)', 
    `title`       VARCHAR(45)    NOT NULL    COMMENT '방 제목', 
    `master`      INT            NOT NULL    COMMENT '방장', 
    `start_date`  TIMESTAMP      NOT NULL    COMMENT '시작일', 
    `end_date`    TIMESTAMP      NOT NULL    COMMENT '종료일', 
    PRIMARY KEY (id)
);

ALTER TABLE sp_room COMMENT '방';

ALTER TABLE sp_room
    ADD CONSTRAINT FK_sp_room_master_sp_user_id FOREIGN KEY (master)
        REFERENCES sp_user (id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- sp_vote Table Create SQL
CREATE TABLE sp_vote
(
    `room_id`     VARCHAR(4)     NOT NULL    COMMENT '방 아이디 (네글자)', 
    `id`          VARCHAR(6)     NOT NULL    COMMENT '투표 아이디 (여섯글자)', 
    `title`       VARCHAR(45)    NOT NULL    COMMENT '투표 제목', 
    `start_date`  TIMESTAMP      NOT NULL    COMMENT '시작일', 
    `end_date`    TIMESTAMP      NOT NULL    COMMENT '종료일', 
    `type`        INT            NOT NULL    COMMENT '투표 유형', 
    PRIMARY KEY (id)
);

ALTER TABLE sp_vote COMMENT '투표';

ALTER TABLE sp_vote
    ADD CONSTRAINT FK_sp_vote_room_id_sp_room_id FOREIGN KEY (room_id)
        REFERENCES sp_room (id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- sp_room_user Table Create SQL
CREATE TABLE sp_room_user
(
    `room_id`  VARCHAR(4)    NOT NULL    COMMENT '방 아이디 (네글자)', 
    `user_id`  INT           NOT NULL    COMMENT '사용자 아이디', 
    PRIMARY KEY (room_id, user_id)
);

ALTER TABLE sp_room_user COMMENT '방:사용자 매칭 테이블';

ALTER TABLE sp_room_user
    ADD CONSTRAINT FK_sp_room_user_user_id_sp_user_id FOREIGN KEY (user_id)
        REFERENCES sp_user (id) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE sp_room_user
    ADD CONSTRAINT FK_sp_room_user_room_id_sp_room_id FOREIGN KEY (room_id)
        REFERENCES sp_room (id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- sp_choice Table Create SQL
CREATE TABLE sp_choice
(
    `vote_id`   VARCHAR(6)     NOT NULL    COMMENT '투표 아이디 (여섯글자)', 
    `id`        INT            NOT NULL    AUTO_INCREMENT COMMENT '선택지 아이디', 
    `contents`  VARCHAR(45)    NOT NULL    COMMENT '내용', 
    PRIMARY KEY (id)
);

ALTER TABLE sp_choice COMMENT '선택지';

ALTER TABLE sp_choice
    ADD CONSTRAINT FK_sp_choice_vote_id_sp_vote_id FOREIGN KEY (vote_id)
        REFERENCES sp_vote (id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- sp_comment Table Create SQL
CREATE TABLE sp_comment
(
    `vote_id`   VARCHAR(6)    NOT NULL    COMMENT '투표 아이디 (여섯글자)', 
    `user_id`   INT           NOT NULL    COMMENT '사용자 아이디', 
    `contents`  TEXT          NOT NULL    COMMENT '내용', 
    PRIMARY KEY (vote_id, user_id)
);

ALTER TABLE sp_comment COMMENT '댓글';

ALTER TABLE sp_comment
    ADD CONSTRAINT FK_sp_comment_vote_id_sp_vote_id FOREIGN KEY (vote_id)
        REFERENCES sp_vote (id) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE sp_comment
    ADD CONSTRAINT FK_sp_comment_user_id_sp_user_id FOREIGN KEY (user_id)
        REFERENCES sp_user (id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- sp_like Table Create SQL
CREATE TABLE sp_like
(
    `vote_id`  VARCHAR(6)    NOT NULL    COMMENT '투표 아이디 (여섯글자)', 
    `user_id`  INT           NOT NULL    COMMENT '사용자 아이디', 
    `type`     INT           NOT NULL    COMMENT '좋아요 유형', 
    PRIMARY KEY (vote_id, user_id)
);

ALTER TABLE sp_like COMMENT '좋아요';

ALTER TABLE sp_like
    ADD CONSTRAINT FK_sp_like_vote_id_sp_vote_id FOREIGN KEY (vote_id)
        REFERENCES sp_vote (id) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE sp_like
    ADD CONSTRAINT FK_sp_like_user_id_sp_user_id FOREIGN KEY (user_id)
        REFERENCES sp_user (id) ON DELETE RESTRICT ON UPDATE RESTRICT;


